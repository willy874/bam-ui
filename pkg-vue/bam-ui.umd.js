var se=Object.defineProperty,ne=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var R=(l,n,f)=>n in l?se(l,n,{enumerable:!0,configurable:!0,writable:!0,value:f}):l[n]=f,m=(l,n)=>{for(var f in n||(n={}))re.call(n,f)&&R(l,f,n[f]);if(A)for(var f of A(n))le.call(n,f)&&R(l,f,n[f]);return l},_=(l,n)=>ne(l,ae(n));var r=(l,n,f)=>(R(l,typeof n!="symbol"?n+"":n,f),f);(function(l,n){typeof exports=="object"&&typeof module!="undefined"?n(exports,require("vue"),require("bam-utility-plugins")):typeof define=="function"&&define.amd?define(["exports","vue","bam-utility-plugins"],n):(l=typeof globalThis!="undefined"?globalThis:l||self,n(l["bam-ui"]={},l.vue,l.bamUtilityPlugins))})(this,function(l,n,f){"use strict";function $(i){return typeof i=="symbol"}var d;(function(i){i[i.NORMAL=0]="NORMAL",i[i.DRAG_MOVE=1]="DRAG_MOVE",i[i.RESIZE_TOP=2]="RESIZE_TOP",i[i.RESIZE_LEFT=3]="RESIZE_LEFT",i[i.RESIZE_BOTTOM=4]="RESIZE_BOTTOM",i[i.RESIZE_RIGHT=5]="RESIZE_RIGHT"})(d||(d={}));const j={},G={},U={get:null};function q(i,e){const t=e?e(i):null;return t instanceof g?t:i}function F(i){throw new Error("not created dialog")}function J(i,e){const t=new g(_(m({},i),{dialogId:i.name?Symbol(i.name):Symbol("Frame")}));return G[t.id]=()=>q(t,e),t}function w(i){return typeof i=="object"&&i instanceof g}const E={mount:[],unmount:[],update:[],bgclick:[],dragstart:[],dragover:[],dragend:[],touchstart:[],touchmove:[],touchend:[]};class g{constructor(e){r(this,"id");r(this,"dialogId");r(this,"view");r(this,"props");r(this,"isOverLimit");r(this,"isDraggable");r(this,"isResizable");r(this,"isFull",!1);r(this,"position");r(this,"element",null);r(this,"top","0px");r(this,"left","0px");r(this,"width");r(this,"height");r(this,"mouseOffsetX",0);r(this,"mouseOffsetY",0);r(this,"close");r(this,"onError");r(this,"hook");r(this,"resizeObserver",null);r(this,"isDragged",!1);r(this,"isResized",!1);r(this,"dialogPadding",60);this.id=Symbol("Frame"),this.dialogId=e.dialogId,this.view=e.view,this.props=e.props||{},this.isOverLimit=e.isOverLimit!==!1,this.isDraggable=e.isDraggable!==!1,this.isResizable=e.isResizable!==!1,this.isFull=e.isFull||!1,this.position=e.position||"auto",this.width=typeof e.width=="number"?e.width+"px":e.width||"auto",this.height=typeof e.height=="number"?e.height+"px":e.height||"auto",this.close=e.close,this.onError=e.onError,this.hook=m({},E),Object.keys(E).forEach(t=>{e.hook&&this.on(t,e.hook[t])}),this.setPosition(e.position||"auto")}setFrameElement(e){this.element=e instanceof Element?e:null}setDraggable(e){e?(this.isDraggable=!0,this.isDragged=!1):(this.isDraggable=!1,this.isDragged=!0)}setResizable(e){e?(this.isResizable=!0,this.isResized=!1):(this.isResizable=!1,this.isResized=!0)}setOverLimit(e){this.isOverLimit=e}setFull(e){this.isFull=e}setPosition(e){const t=F(this.dialogId);this._setPosition(e,t)}_setPosition(e,t){if(typeof e=="object"&&(this.top=typeof e.top=="number"?e.top+"px":e.top||"0",this.left=typeof e.left=="number"?e.left+"px":e.left||"0"),this.element){const s=this.element.clientWidth,o=this.element.clientHeight;if(e==="center"&&(this.top=window.innerHeight/2-o/2+"px",this.left=window.innerWidth/2-s/2+"px"),e==="auto"){const a=t.frames.length;this.top=window.innerHeight/3-o/3+10*(a-1)+"px",this.left=window.innerWidth/2-s/2+10*(a-1)+"px"}}else if(e==="center"&&(this.top=`calc(${window.innerHeight/2}px - 50%)`,this.left=`calc(${window.innerWidth/2}px - 50%)`),e==="auto"){const s=t.frames.length;this.top=`calc(${window.innerHeight/3+10*(s-1)}px)`,this.left=`calc(${window.innerWidth/2+10*(s-1)}px - 50%)`}}setBoxSize(){if(this.element&&this.isOverLimit){const e=this.element.clientWidth,t=this.element.clientHeight,s=f.getViewportOffset(this.element);s.left+e>window.innerWidth&&(this.width=window.innerWidth-s.left-this.dialogPadding+"px"),s.top+t>window.innerWidth&&(this.height=window.innerHeight-s.top-this.dialogPadding+"px")}}on(e,t){return t&&Object.keys(E).includes(e)?(this.hook[e].push(t),!0):!1}off(e,t){const s=this.hook[e];if(t){if(s.includes(t)){const o=s.indexOf(t);if(o>=0)return s.splice(o,1),!0}}else return s.splice(0),!0;return!1}async _onClose(e){const t=e.frames.map(a=>a.id).indexOf(this.id),o=e.frames.splice(t,1)[0];return(o==null?void 0:o.close)&&await o.close(e),this.close=null,o}onClose(){const e=F(this.dialogId);return this._onClose(e)}onMount(...e){this.element&&(this.resizeObserver=new ResizeObserver(()=>{typeof this.position=="string"&&(this.isDraggable||this.setPosition(this.position),this.isResizable||this.setBoxSize())}),this.resizeObserver.observe(this.element)),this.hook.mount.forEach(t=>{t.apply(this,e)})}onUnmount(...e){this.element&&this.resizeObserver&&this.resizeObserver.unobserve(this.element),this.element=null,this.hook.unmount.forEach(t=>{t.apply(this,e)})}onUpdate(...e){this.hook.update.forEach(t=>{t.apply(this,e)})}onResize(...e){this.setPosition(this.position),this.setBoxSize(),this.hook.update.forEach(t=>{t.apply(this,e)})}onDragstart(...e){this.hook.update.forEach(t=>{t.apply(this,e)})}onTouchstart(...e){this.hook.touchstart.forEach(t=>{t.apply(this,e)})}onDragmove(e){if(this.isFull=!1,this.element&&this.isDraggable){this.isDragged=!0;const t={top:this.top,left:this.left},s=this.element.clientWidth,o=this.element.clientHeight;this.isOverLimit?(window.innerWidth-s<e.pageX-this.mouseOffsetX?t.left=window.innerWidth-s-1+"px":e.pageX-this.mouseOffsetX<1?t.left="0":t.left=e.pageX-this.mouseOffsetX+"px",window.innerHeight-o<e.pageY-this.mouseOffsetY?t.top=window.innerHeight-o-1+"px":e.pageY-this.mouseOffsetY<1?t.top="0":t.top=e.pageY-this.mouseOffsetY+"px"):(t.top=e.pageY-this.mouseOffsetY+"px",t.left=e.pageX-this.mouseOffsetX+"px"),this.setPosition(t)}}onDragresize(e,t){if(this.isFull=!1,this.element&&this.isResizable){this.isResized=!0;const s=this.element.clientWidth,o=this.element.clientHeight,a=f.getViewportOffset(this.element);if(this.top=a.top+"px",this.left=a.left+"px",this.width=s+"px",this.height=o+"px",t===d.RESIZE_TOP){const h=a.top-e.pageY;this.top=a.top-h+"px",this.height=o+h+"px"}if(t===d.RESIZE_BOTTOM){const h=e.pageY-a.top-o;this.height=o+h+"px"}if(t===d.RESIZE_RIGHT){const h=e.pageX-a.left-s;this.width=s+h+"px"}if(t===d.RESIZE_LEFT){const h=a.left-e.pageX;this.left=a.left-h+"px",this.width=s+h+"px"}}}onDragover(...e){this.hook.dragover.forEach(t=>{t.apply(this,e)})}onTouchmove(...e){this.hook.touchmove.forEach(t=>{t.apply(this,e)})}onDragend(...e){this.hook.dragend.forEach(t=>{t.apply(this,e)})}onTouchend(...e){this.hook.touchend.forEach(t=>{t.apply(this,e)})}createVNode(){return this.view}}const O={mount:[],unmount:[],update:[],bgclick:[]};class v{constructor(e){r(this,"id");r(this,"frames",[]);r(this,"isBackgroundMask");r(this,"backgroundMask");r(this,"focusFrame",null);r(this,"eventType",d.NORMAL);r(this,"element",null);r(this,"touches",[]);r(this,"prevTouches",[]);r(this,"hook");this.id=e.id,this.isBackgroundMask=e.isBackgroundMask,this.backgroundMask=e.backgroundMask,this.hook=m({},O),Object.keys(O).forEach(t=>{e.hook&&this.on(t,e.hook[t])})}on(e,t){return t&&Object.keys(O).includes(e)?(this.hook[e].push(t),!0):!1}off(e,t){const s=this.hook[e];if(s.includes(t)){const o=s.indexOf(t);if(o>=0)return s.splice(o,1),!0}return!1}onMount(...e){this.hook.mount.forEach(t=>{t.apply(this,e)})}onUnmount(...e){this.element=null,this.hook.unmount.forEach(t=>{t.apply(this,e)})}onUpdate(...e){this.hook.update.forEach(t=>{t.apply(this,e)})}onResize(e){[...this.frames].forEach(t=>{t.onResize(e)})}onBgclick(e){this.element&&e.target instanceof Node&&this.element.contains(e.target)&&(this.hook.bgclick.forEach(t=>{t.apply(this,e)}),[...this.frames].forEach(t=>{var s;((s=t.hook)==null?void 0:s.bgclick)&&t.hook.bgclick.forEach(o=>{o.apply(t,e)})}))}onDragstart(e,t,s){const o=this.getFrame(t);if(o&&o.element&&e.dataTransfer){f.clearDragImage(e),this.focusFrame=o;const a=f.getViewportOffset(o.element);o.mouseOffsetX=e.pageX-a.left,o.mouseOffsetY=e.pageY-a.top,this.eventType=s,o.onDragstart(e)}else console.warn("not element or event not dataTransfer target")}onTouchstart(e,t,s){const o=this.getFrame(t);if(o){if(this.touches=Array.from(e.touches),o.element&&s===d.DRAG_MOVE){const a=this.touches[0],h=f.getViewportOffset(o.element);o.mouseOffsetX=a.pageX-h.left,o.mouseOffsetY=a.pageY-h.top,this.focusFrame=o,this.eventType=s}o.onTouchstart(e)}}onDragover(e){const t=this.focusFrame;if(t&&t.element){const s={pageX:e.pageX,pageY:e.pageY};this.eventType===d.DRAG_MOVE&&t.onDragmove(s),(this.eventType===d.RESIZE_TOP||this.eventType===d.RESIZE_LEFT||this.eventType===d.RESIZE_BOTTOM||this.eventType===d.RESIZE_RIGHT)&&t.onDragresize(s,this.eventType),t.onDragover(e)}}onTouchmove(e){const t=this.focusFrame;if(t){if(this.touches=Array.from(e.touches),this.eventType===d.DRAG_MOVE&&this.touches.length===1){const s=this.touches[0];t.onDragmove({pageX:s.pageX,pageY:s.pageY})}t.onTouchmove(e)}}onDragend(e){const t=this.focusFrame;t&&(this.eventType=d.NORMAL,t.mouseOffsetX=0,t.mouseOffsetY=0,t.onDragend(e))}onTouchend(e){const t=this.focusFrame;t&&(this.touches=Array.from(e.touches),this.touches.length===0&&(this.eventType=d.NORMAL,t.mouseOffsetX=0,t.mouseOffsetY=0),t.onTouchend(e))}setRootElement(e){this.element=e instanceof Element?e:null}setFrameItemElement(e){return t=>{this.frames[e].element=t}}sortToRight(e){const t=this.getFrame(e);if(t){const s=this.frames.map(a=>a.id).indexOf(t.id),o=this.frames.splice(s,1);this.frames.push(...o)}}openFrame(e,t){return new Promise(async(s,o)=>{w(e)&&(e.close=s,e.onError=o);const a=w(e)?e:J(_(m({},t),{view:await e(),close:s,onError:o}));this.frames.push(a)})}async callbackCloseFrame(e,t){return await Promise.all(e.map(async s=>{const o=await s.onClose();return t&&t(o),o}))}async closeFrame(e,t){let s=[];if(typeof e=="number"){const o=e;s=this.frames.slice(o,o+1)}else if($(e)){const o=e,a=this.frames.map(h=>h.id).indexOf(o);s=this.frames.slice(a,a+1)}else if(typeof e=="object"){if(w(e)){const o=e;s=this.frames.filter(a=>a.dialogId===o.dialogId)}}else typeof e=="function"?s=e(this.frames):s=this.frames.slice();return await this.callbackCloseFrame(s,t)}_getFrame(e){if(typeof e=="object"&&e instanceof g)return this.frames.find(t=>t.id===e.id);if(typeof e=="number"){const t=e;return this.frames[t]}if(typeof e=="symbol"){const t=e;return this.frames.find(s=>s.id===t)}}getFrame(e){return this._getFrame(e)}}function T(i){return{setResizable:e=>i.setResizable(e),setDraggable:e=>i.setDraggable(e),setOverLimit:e=>i.setOverLimit(e),setFull:e=>i.setFull(e),setPosition:(...e)=>i.setPosition(...e),setBoxSize:()=>i.setBoxSize(),on:(e,t)=>i.on(e,t),off:(e,t)=>i.off(e,t)}}function x(i){return{id:i.id,dialogId:i.dialogId,element:i.element,top:i.top,left:i.left,width:i.width,height:i.height,mouseOffsetX:i.mouseOffsetX,mouseOffsetY:i.mouseOffsetY,isOverLimit:i.isOverLimit,isDraggable:i.isDraggable,isResizable:i.isResizable,isFull:i.isFull}}var u={dialog:"bam-dialog",dialog_container:"bam-dialog_container",dialog_frame:"bam-dialog_frame",dialog_view:"bam-dialog_view",dialog_resize_mode:"bam-dialog_resize_mode",dialog_resize_top:"bam-dialog_resize_top",dialog_resize_bottom:"bam-dialog_resize_bottom",dialog_resize_right:"bam-dialog_resize_right",dialog_resize_left:"bam-dialog_resize_left",css:{dialog:`.dialog {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}`,dialog_container:`.dialog_container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}`,dialog_frame:`.dialog_frame {
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: auto;
}`,dialog_view:`.dialog_view {
  width: 100%;
  height: 100%;
}`,dialog_resize_mode:`.dialog_resize_mode {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: auto;
  scroll-behavior: smooth;
  overscroll-behavior: none;
}`,dialog_resize_top:`.dialog_resize_top {
  position: absolute;
  cursor: ns-resize;
  height: 0.5rem;
  top: -1px;
  left: 0;
  right: 0;
}`,dialog_resize_bottom:`.dialog_resize_bottom {
  position: absolute;
  cursor: ns-resize;
  height: 0.5rem;
  bottom: -1px;
  left: 0;
  right: 0;
}`,dialog_resize_right:`.dialog_resize_right {
  position: absolute;
  cursor: ew-resize;
  width: 0.5rem;
  right: -1px;
  top: 0;
  bottom: 0;
}`,dialog_resize_left:`.dialog_resize_left {
  position: absolute;
  cursor: ew-resize;
  width: 0.5rem;
  left: -1px;
  top: 0;
  bottom: 0;
}`}};class I extends v{constructor(e){super(e);r(this,"tag","vue");r(this,"frames",[]);r(this,"focusFrame",null)}getFrame(e){return this._getFrame(e)}openFrame(e,t){return new Promise(async(s,o)=>{D(e)&&(e.close=s,e.onError=o);const a=D(e)?e:P(_(m({},t),{view:await e(),close:s,onError:o}));this.frames.push(a)})}}class z extends g{constructor(e){super(e);r(this,"tag","vue")}setPosition(e){const t=k(this.dialogId);this._setPosition(e,t)}onClose(){const e=k(this.dialogId);return this._onClose(e)}createVNode(){return n.isVNode(this.view)?this.view:n.h(this.view,{class:u.dialog_view,frameData:x(this),frameMethods:T(this),frameProps:this.props})}}const y={},M={},p={get:null};function S(i={}){const e=new I({id:typeof i.name=="symbol"?i.name:Symbol(i.name),hook:i.hook||{},isBackgroundMask:i.isBackgroundMask!==!1,backgroundMask:i.backgroundMask||"transparent"}),t=()=>n.reactive(e);return y[e.id]=t,p.get||(p.get=t),e}function L(i){const e=()=>n.reactive(i);return y[i.id]=e,p.get=e,e()}function k(i){if(!p.get)throw new Error("not created dialog");return(i&&y[i]||p.get)()}function C(i){return M[i]()}function P(i){const e=new z(_(m({},i),{dialogId:i.name?Symbol(i.name):Symbol("Frame")}));return M[e.id]=()=>e,e}function D(i){return typeof i=="object"&&i instanceof z}var b=n.defineComponent({name:"BamFrame",props:{dialog:{type:Object,required:!0},view:{type:Object,required:!0},frame:{type:Object,required:!0},zIndex:{type:Number,default:0}},setup(i,{expose:e}){const t=n.getCurrentInstance();e({}),i.dialog.isBackgroundMask&&i.frame.hook.bgclick.length===0&&i.frame.on("bgclick",()=>i.frame.onClose());const s=n.computed(()=>x(i.frame)),o=n.computed(()=>T(i.frame));return n.onMounted(()=>i.frame.onMount(t)),n.onUpdated(()=>i.frame.onUpdate(t)),n.onUnmounted(()=>i.frame.onUnmount(t)),()=>n.createVNode("div",{ref:a=>i.frame.setFrameElement(a),class:u.dialog_frame,style:{zIndex:i.zIndex,transform:f.getTransformStyleString({translateX:i.frame.isFull?"0":i.frame.left,translateY:i.frame.isFull?"0":i.frame.top}),width:i.frame.isFull?"100vw":i.frame.width,height:i.frame.isFull?"100vh":i.frame.height},onClick:a=>a.stopPropagation(),onMousedown:()=>i.dialog.sortToRight(i.frame.id)},[n.isVNode(i.view)?i.view:n.createVNode(i.view,{class:u.dialog_view,"frame-data":s.value,"frame-methods":o.value,"frame-props":i.frame.props},null)])}}),K=n.defineComponent({name:"BamDialog",props:{dialog:{type:Object,default:()=>({})}},setup(i,{expose:e}){const t=n.getCurrentInstance(),s=i.dialog instanceof v?i.dialog:S(i.dialog),o=n.isReactive(s)?s:L(s);e({dialog:o});const a=n.computed(()=>o.isBackgroundMask&&o.frames.length),h=c=>o.onBgclick(c),N=c=>o.onDragover(c),X=c=>o.onDragend(c),Y=c=>o.onTouchmove(c),H=c=>o.onTouchend(c),Z=c=>o.onResize(c);return n.onMounted(()=>{o.onMount(t),document.body.addEventListener("click",h),document.body.addEventListener("dragover",N),document.body.addEventListener("dragend",X),document.body.addEventListener("touchmove",Y),document.body.addEventListener("touchend",H),window.addEventListener("resize",Z)}),n.onUpdated(()=>{o.onUpdate(t)}),n.onUnmounted(()=>{o.onUnmount(t),document.body.removeEventListener("click",h),document.body.removeEventListener("dragover",N),document.body.removeEventListener("dragend",X),document.body.removeEventListener("touchmove",Y),document.body.removeEventListener("touchend",H),window.removeEventListener("resize",Z)}),()=>n.createVNode("div",{ref:c=>o.setRootElement(c),class:u.dialog,style:{pointerEvents:a.value?"auto":"none",opacity:o.frames.length?1:0}},[n.createVNode("div",{class:u.dialog_container,style:{background:o.backgroundMask}},null),o.frames.map((c,ie)=>{const W=C(c.id);if(W){const oe=n.markRaw(W.createVNode());return n.createVNode(b,{key:c.id,"z-index":ie,frame:c,dialog:o,view:oe},null)}else return null})])}});function V(i,e){return i.push(e),e.parent?V(i,e.parent):i}function Q(i){const e=[];return i?V(e,i):[]}function B(i){const e=n.getCurrentInstance();if(e&&i){const t=Q(e);for(const s of t){if(!s.type.name&&!i.name)return;if(s.type.name===i.name)return s.proxy}}}var ee=n.defineComponent({name:"bam-frame-draggable",props:{tag:{type:String,default:"div"}},setup(i,e){const t=a=>h=>{a&&a.dialog.onDragstart(h,a.frame.id,d.DRAG_MOVE)},s=a=>h=>{a&&a.dialog.onTouchstart(h,a.frame.id,d.DRAG_MOVE)},o=B(b);return()=>o?n.createVNode(i.tag,{style:{cursor:o.frame.isDraggable&&"move"},draggable:!0,onDragstart:t(o),onTouchstart:s(o)},{default:()=>[e.slots.default&&e.slots.default()]}):null}}),te=n.defineComponent({name:"bam-frame-resize",props:{tag:{type:String,default:"div"}},setup(i,e){const t=(o,a)=>h=>{o&&o.dialog.onDragstart(h,o.frame.id,a)},s=B(b);return()=>s?n.createVNode(n.Fragment,null,[n.createVNode(i.tag,{class:{[u.dialog_resize_mode]:s.frame.width!=="auto"&&s.frame.height!=="auto"}},{default:()=>[e.slots.default&&e.slots.default()]}),s.frame.isResizable?n.createVNode(n.Fragment,null,[n.createVNode("div",{class:u.dialog_resize_top,onClick:o=>o.stopPropagation(),draggable:!0,onDragstart:t(s,d.RESIZE_TOP)},null),n.createVNode("div",{class:u.dialog_resize_bottom,onClick:o=>o.stopPropagation(),draggable:!0,onDragstart:t(s,d.RESIZE_BOTTOM)},null),n.createVNode("div",{class:u.dialog_resize_right,onClick:o=>o.stopPropagation(),draggable:!0,onDragstart:t(s,d.RESIZE_RIGHT)},null),n.createVNode("div",{class:u.dialog_resize_left,onClick:o=>o.stopPropagation(),draggable:!0,onDragstart:t(s,d.RESIZE_LEFT)},null)]):null]):e.slots.default&&e.slots.default()}});l.BamDialog=K,l.BamFrame=b,l.BamFrameDraggable=ee,l.BamFrameResize=te,l.Dialog=I,l.Frame=z,l.createDialog=S,l.createFrame=P,l.isFrame=D,l.setDefaultDialog=L,l.useDialog=k,l.useFrame=C,Object.defineProperty(l,"__esModule",{value:!0}),l[Symbol.toStringTag]="Module"});
